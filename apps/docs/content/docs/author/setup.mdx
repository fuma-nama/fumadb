---
title: Setup FumaDB
description: Setup FumaDB for your package.
---

## Installation

Install it to your package.

```npm
npm i fumadb
```

<Callout title="Node.js">Node.js 22 or above recommended.</Callout>

## How to Use

FumaDB expects a schema file for each version, create a `schema/v1.ts` file:

```ts title="schema/v1.ts"
import { column, idColumn, schema, table } from "fumadb/schema";

export const users = table("users", {
  id: idColumn("id", "varchar(255)", { default: "auto" }),
  name: column("name", "string"),
});

export const messages = table("messages", {
  id: idColumn("id", "varchar(255)", { default: "auto" }),
  user: column("user", "varchar(255)"),
  content: column("content", "string"),
});

export const v1 = schema({
  version: "1.0.0", // should always start with v1
  tables: {
    users,
    messages,
  },
  relations: {
    users: ({ many }) => ({
      messages: many(messages),
    }),
    messages: ({ one }) => ({
      author: one(users, ["user", "id"]).foreignKey(),
    }),
  },
});
```

Create a `db.ts` file, each database instance represents one schema, with its own versioning cycle:

```ts title="db.ts"
import { fumadb } from "fumadb";
import { v1 } from "@/schemas/v1";

const chatDb = fumadb({
  namespace: "fuma-chat",
  schemas: [v1],
});
```

Please be careful that:

- Once your package is published, `namespace` must not be changed.
- Once your package is published, do not change your existing schemas. Instead, establish a new version for the schema (such as `1.0.0` to `1.1.0`) and append it to `schemas`.

The consumer should call the `configure()` function. Then, your library can receive the FumaDB instance and perform further actions.

```ts title="lib/chat.ts"
import { chatDb, myLibrary } from "your-library";

export const configuredChatDb = chatDb.configure({
  provider: "mysql",
  type: "kysely",
  db: kysely, // kysely instance
});

myLibrary(configuredChatDb);
```

### Querying

On the received FumaDB instance, you can query using the ORM interface:

```ts title="index.ts"
import { type InferFumaDB } from "fumadb";

export function myLibrary(db: InferFumaDB<typeof chatDb>) {
  const orm = db.abstract;
  const { users } = orm.tables;

  return {
    async getUser() {
      const result = await orm.findFirst(users, {
        select: ["name"],
        where: (b) => b.and(b.isNotNull(users.name), b(users.id, "=", "test")),
      });

      return result;
    },
  };
}
```

### CLI

When your library updates, you want to notify the consumers to migrate their database as well.
It's up to you to hook the `postinstall` command in your package, and print a notification.

FumaDB provides a CLI tool with interactive experience to migrate database, you can wrap it in your library:

```ts title="cli.ts"
import { type InferFumaDB } from "fumadb";
import { createCli } from "fumadb/cli";

export function run(db: InferFumaDB<typeof chatDb>) {
  const { main } = createCli({
    db,
    command: "chat-lib",
    // you can import the version from your package's `package.json`
    version: "1.0.0",
  });

  return main();
}
```

And suggest the consumer to create a script to start the CLI app.

```js title="scripts/chat.mjs"
import { configuredChatDb } from "./lib/chat";
import { run } from "your-library/cli";

void run(configuredChatDb);
```

The consumer can run it with:

```bash
node ./scripts/chat.mjs
```
